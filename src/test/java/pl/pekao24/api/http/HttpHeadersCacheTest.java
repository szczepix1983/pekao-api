package pl.pekao24.api.http;

import org.junit.jupiter.api.Test;
import org.springframework.http.HttpHeaders;
import pl.pekao24.api.Api;

import static org.assertj.core.api.Assertions.assertThat;

class HttpHeadersCacheTest {

    @Test
    void extractCookies() {
        HttpHeaders lastResponseHeaders = new HttpHeaders();
        String expectedResult = "ID_TOKEN=eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkExMjhDQkMtSFMyNTYiLCJjdHkiOiJKV1QifQ.EcRkFkWN4xCOAl0JUtsJ1iAea0BPiqmvIz_ErHhQlXC-GYjBuWtrIIFAoeJSSM-Wijx1H4ISOWqybQYBJrRC8G-ZbSjmEVcwCHVhyczC551LeWSZt_hWUhvajurPvc4dSbgLLD8uSnL4M9mevpP-_0Zd2_f8tgR8Jj-jnvhAdg2gW3C7T3_OxOOyz76VnRmz93y8s6DcmQFBFQ8rOlnLeD80bROys2XjAuCs2Lf0-0F1L1GCXoRH0FOzTGHXszaVaNcd2jkR8NHGhVzSGAScr6i9HTmE8VIbrM1Jdx0IQIso9X7ocn3G1tuOykq3QgPX0EWh9HGdb0U4mc8x43XjTA.MxLVQ8--0UGcIKGZm61FOQ.sAOBBkWKhAqQXHeYHR7-ZGilfU7sJjMv9omu_xfX9E08NyVTc6b-jwdkf9v-F3ivQfdPiatPyO_5MMV-zoTEahp0WziITlNFpFoM6trFy8I4iAny3qxnadnwcy6s1_Ucu7DaM_TBBAaS4rA37f2b2QzO-9jjVeP_rymL4ud_qI3lwdoO18IYzv77xdQi_-4gXBYWP-gUo8x6WFrHbAnT9yklwF9MKJjlYPS11sSLRr-KX5Ez0P_0gofl_ZX56bbnuz0VLGYqfzQPpnE86eVl2oqilnENlfxABp72fDsIKtA96Rf1Lva7dXOn0OP-avtpUY_jHCFwkBTqjYSk1jB8xCItVS4BcYljfstKt5USyYQAPFrpSKaJ8EqgN1skd3jfKy7ICeW0gSjFsqCicgsQtAWPaM6VBuWU3s-digiY5MNYxq7uFUD3xCa1XYob3DygbpXd2bz0qqtHJ5z5AkYxPwpd0wA7_zTiSYbjptZmmht5bcn3JUpOsAmz-qtDibh3DMn3-QnKtE5QhkuTb5aPyJlPjRIaHsNltmgv95UrhBwpHYlJDoVUuuGPypm3jf3SjKLvZUrY98XmbHYJaHAGqsYbOj-KEvgicSLxdAAhuXx_NGyxyCakNkT2ULb-Z09UhW5kVWRf6uOcfT_gqgbs-KRth5jgJZ4XIn4gb4WmOVo6djSIIc1FCWL-c3cpZH3yoemon1fuXWcvH6Qyy09TSkIbiD3YbUBzbgKgp7IiUIR_DUfMgJpoHGVzpxbLSpOFe64KuZwXa3OYPGWtPwzgcwRCBvD4InNbXmCDz0f1DsO7UQ7Ycv3JGsgaB1dYFJbTxxmtYNjR54iPiUCsZ-8MMsCiXIa3ni4uLF21C_ffdSj9hpev6F5Xb-UsiotCemhwQZ0CbQlpEPp3TQy51X4UEncCn2z_ucEwuBBp0C66hla4pZEygyxydc2EvljcHEWEGTMHuQIthgC0DImhk1fjMtNp8FVCtKvNIevOVZpv5RFkV1XIFiqodUMrxk6S31NpMBjgLD7TD7c-3DtV1zESl4N_L8zlKmepZCnvASj779l0g814hyiQLVcs-4U7tNgvGFQjzJRlF0-vASS40mfARBVKMJPRMBtBMlhw8H72nz_oKRFMedIy7D4AuEHcXfZEiIfQ9S_0fFNb_yzepoxOkHXbhbxgQ6Lgpw9nP1spqSQwy5Dl4tfzXvTddCpQqxwDDCO-YOl1Iqa_L1-_cLm3EHarKf-_0FcEusASnVew_FZEdso_bboZhLQVSRKyb08cEysxHNQz2PgUJofhEydsFMHGLQcZqauXKHQAi3K9VwQaKV3rJxrevqYrOowO8nrCgLKsqvqtsRIgJ58p5gW2Tm1AX4zEXVUKpetRFhz7Q2hJ5Q6E7Jh69yM8YG4O_2m-vU5DFPK1F5CZdEsIE59dg4--UfdApk9by9pMmq0GWK9Ig6xGipXJtFWdhE0DQcbmIAK3XgFm3Wd1PA9EHACuT_qftyxHYF9XdcinbJAmG1XWDF3ILgTtWQLEMliXIZhUSwgrJoN9uUKen9kht-xPDzGubauxuSAfuUsGXFpGI_HtHzHNHQunCqXZ9S3SWZNAOIU5hDEwJjsRKs3ug2tzFyw90GA0OLV2xSWgDFe1nYnW5BbxBwVRSTxDnMztn07qva8uWxw8XCz8GcxWMyPsTnj-MGbOB3i0mmX8Nbv9nx2hidHXe9h71z7XmKtKDzniG4F4fDzTC1BTyhOaRpjK92x6Hy2alfwenVUjOftPAPV-sXdF6ykrqMrfweH6Yje3EoVosE301ZdmCUG2hRHDafZRcu_VYRYHhpyid2kjg_fNETT4745VfpIuF-LdPtlyCEUyy8avQfbYz2s27Qv0AQ.0i7OdqefK-FcobGlbsWXIg";
        lastResponseHeaders.set(HttpHeaders.SET_COOKIE, expectedResult + ";REF_TOKEN=eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkExMjhDQkMtSFMyNTYiLCJjdHkiOiJKV1QifQ.pzeCKzVGGp_OqTXwA82BfO52G3yRpAOfAxx5LMYwG8P-F8schnYoWslgc6wragr81AcA6cg1ap6fE0NdWKD7p_4GsC4DW4hl1nRMs8YVYoycmpin9zRkxejiTaSUDKJ6V11y-LykqKxdNPfzJcjy_synwhrm5e4pgzyHhVJRopeZWfZnoyXD5VZCf0aCXU958OfD5dKn6kW5N-YvIuMeGQucBI4dGhT2Jt4PfxdUbp0kZjpUYmu3KlXOGQp_hT0QIbEW6HkNedOzoXrkRwGSSCxZH3e8JaQNhXCU6nFUXkar9IEdFUoRaSzmzn6-8GEOV89UssfMTKR19FLI-WoGyA.II9sTXZCNDkjwyuqSaYOyQ.G8Nn3uAecEbVeKrEBSAC6f8LHe-fiZr3rJ3xV2oeloZwVyj5fcEmWKwaX_BTMt8xhSUT-3Qwin4fTChCI856yjIigrgKkr_q7EN9EET-je1kQDMnPivrYtCURXpODR1YDvMjUNHwR5ePo2wHi4Imf1jxO0-HFDYg3Iq11gP6fJB5fT-J4Vfuzz1TJrQ4NzCSdKa7nzHG6Hgnj8XSZc-HntHBPsHErCkUnGqL5zNnSYG4gFI4KK71BE9bOUGwu3uSefEvGRUN1C_BvRZNLvuedFGVhP2b1DkwFO27MyDv-Eb7tuOpHaiVbZt7HO5deT6P17fndPXOVzg8kT9XVSszNxtcSla42-lEzOGq1w0LOuEGAYNg2bofzxRn9eSMzdFTOUm-yd1zFokgyIZj-eJdyiZEY0gFA75HDGpf4abF9-ceDoga_LHLYtWQIzao-ObvtA8bXjxMsQ5pCoJ5HgPiqYE-nLOdPFm-bhEcfKO8XuZgg8XnnzL-NdT3Dv62BozrDRwB73nKPHoWcq9u9l7wcxATmZoWeZFsudOT8NLQ-tIitKXGvsqcfbl9LFj7IwrUMnM90ziZ6iU_oGVH3GVdg_hw8hyRCEziuLxGSspeA9ffL7wn-NmHswKqBLZxNT9Q8kfXWUDyLVM4qLK4mUjPy7R9Buml4hoeNzFcoBnn4Eh1mUjysJMr_4RdWgWKxjJhR2BtfFzSO0VWrNsb8uFGkw.GVjoBiqxEVDW96WQnIF8Wg;SESSION_ID=1cEynbHlmCU00LpqRFTWEni");
        HttpHeadersCache headersCache = new HttpHeadersCache();
        headersCache.put(Api.ACCOUNT_LIMITS.getUrl(), lastResponseHeaders);

        String result = headersCache.extractCookies(Api.ACCOUNT_LIMITS);

        assertThat(result).isEqualTo(expectedResult);
    }

    @Test
    void extractXCsrfToken() {
        HttpHeaders lastResponseHeaders = new HttpHeaders();
        String expectedResult = "e14db79a-cb2e-40d5-aa5b-819386ac6044";
        lastResponseHeaders.set("X-CSRF-TOKEN", expectedResult);
        HttpHeadersCache headersCache = new HttpHeadersCache();
        headersCache.put(Api.ACCOUNT_LIMITS.getUrl(), lastResponseHeaders);

        String result = headersCache.extractXCsrfToken(Api.ACCOUNT_LIMITS);

        assertThat(result).isEqualTo(expectedResult);
    }
}